The code was generated by https://www.perplexity.ai/ with two different attempts.
It was manually edited to a working state.